import requests
from urllib.parse import urlparse

from modules.sql_injection import SQLInjectionModule
from modules.xss import XSSModule


class Scanner:
    def __init__(self, url):
        self.url = self.ensure_http(url)
        self.parsed_url = urlparse(self.url)
        self.scheme = self.parsed_url.scheme
        self.domain = self.parsed_url.netloc

    def ensure_http(self, url):
        if not urlparse(url).scheme:
            return 'http://' + url
        return url

    def get_target_url(self):
        return f"{self.scheme}://{self.domain}"

    def get_path(self):
        return self.parsed_url.path

    def scan(self):
        sql_injection_scanner = SQLInjectionModule(self.get_target_url())
        xss_scanner = XSSModule(self.get_target_url())

        results = {
            "SQL Injection": sql_injection_scanner.scan(),
            "XSS": xss_scanner.scan()
        }

        return results
